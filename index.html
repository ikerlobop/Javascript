<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lectura y Escritura PLC S7-1200 con Snap7</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 1rem 2rem;
        }
        h1, h2 {
            color: #2e3c59;
        }
        pre {
            background-color: #eee;
            padding: 1em;
            border-radius: 6px;
            overflow-x: auto;
        }
        .section {
            margin-bottom: 2rem;
        }
        .footer {
            text-align: center;
            font-size: 0.8rem;
            color: #666;
        }
    </style>
</head>
<body>

    <h1>Comunicaci√≥n Python - PLC Siemens con Snap7</h1>

    <div class="section">
        <h2>¬øQu√© vamos a aprender?</h2>
        <p>
            En esta pr√°ctica veremos c√≥mo usar una librer√≠a Python llamada <strong>Snap7</strong> para conectarnos
            a un PLC Siemens S7-1200, leer y escribir datos en un bloque de datos (DB) y trabajar con distintos tipos: enteros, reales y booleanos.
        </p>
    </div>

    <div class="section">
        <h2>üîå C√≥digo de Ejemplo</h2>
        <p>Este script conecta al PLC con IP <strong>192.168.0.100</strong>, accede al DB1 y permite modificar variables:</p>
        <pre><code>import snap7
from snap7.util import *
from snap7.type import Areas
import time

def leer_datos_db1(client):
    data = client.read_area(Areas.DB, 1, 0, 14)

    entero1 = get_int(data, 0)    # Static_1
    entero2 = get_int(data, 2)    # Static_2
    real1 = get_real(data, 4)     # Static_3
    real2 = get_real(data, 8)     # Static_4
    bool1 = get_bool(data, 12, 0) # Static_5
    bool2 = get_bool(data, 12, 1) # Static_6

    print("\nüìä Valores actuales en DB1:")
    print(f"Static_1 (Int): {entero1}")
    print(f"Static_2 (Int): {entero2}")
    print(f"Static_3 (Real): {real1}")
    print(f"Static_4 (Real): {real2}")
    print(f"Static_5 (Bool): {bool1}")
    print(f"Static_6 (Bool): {bool2}")
    return data

def main():
    client = snap7.client.Client()
    client.connect("192.168.2.44", 0, 1)

    if client.get_connected():
        print("‚úÖ Conectado al PLC.")

        try:
            while True:
                # Leer y mostrar valores actuales
                data = leer_datos_db1(client)

                # Solicitar nuevos valores
                nuevo_entero1 = int(input("\nIntroduce nuevo valor para Static_1 (Int): "))
                nuevo_real2 = float(input("Introduce nuevo valor para Static_4 (Real): "))
                nuevo_bool1 = input("Introduce nuevo valor para Static_5 (Bool, 0 o 1): ") == '1'

                # Modificar los datos en la copia local
                set_int(data, 0, nuevo_entero1)
                set_real(data, 8, nuevo_real2)
                set_bool(data, 12, 0, nuevo_bool1)

                # Escribir al PLC
                client.write_area(Areas.DB, 1, 0, data)
                print("\nüìù Datos escritos correctamente.")

                # Leer y mostrar los nuevos valores
                leer_datos_db1(client)

                # Esperar o continuar
                continuar = input("\n¬øDeseas modificar de nuevo? (s/n): ").lower()
                if continuar != 's':
                    break

        except Exception as e:
            print(f"‚ùå Error: {e}")
        finally:
            client.disconnect()
            print("üîå Desconectado del PLC.")
    else:
        print("‚ùå No se pudo conectar al PLC.")

if __name__ == "__main__":
    main()

        </code></pre>
    </div>

    <div class="section">
        <h2>üí° Pistas</h2>
        <ul>
            <li>Se debe importar correctamente la librer√≠a Snap7.</li>
            <li>El acceso <strong>PUT/GET</strong> debe estar activado en el PLC.</li>
            <li>Los DB deben estar <strong>no optimizados</strong> para que las direcciones funcionen.</li>
            <li>Snap7 solo funciona con PLCs Siemens (S7-300/400/1200/1500).</li>
        
        </ul>
    </div>

    <div class="footer">
        P√°gina educativa elaborada por Iker Lobo P√©rez ‚Äì Formaci√≥n Industrial y Automatizaci√≥n ‚Äì 2025
    </div>

</body>
</html>
